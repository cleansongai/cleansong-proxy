<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CleanSong Audio Processor</title>
  <style>
    body {
      background: none;
      min-height: 100vh;
      margin: 0;
      font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      background: none;
      border-radius: 18px;
      box-shadow: none;
      padding: 2.5rem 2rem 2rem 2rem;
      max-width: 420px;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.2rem;
    }
    h1 {
      margin: 0 0 0.5rem 0;
      font-size: 2rem;
      color: #00ffff;
      letter-spacing: 1px;
      text-shadow: 0 0 8px #00ffff, 0 0 16px #00ffff;
    }
    .file-input {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      width: 100%;
    }
    input[type="file"] {
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #00ffff;
      background: #000;
      width: 100%;
      font-size: 1rem;
      color: #39FF14;
      box-shadow: 0 0 8px #00ffff;
    }
    input[type="file"]::file-selector-button {
      color: #00ffff;
      background: #000;
      border: 1px solid #00ffff;
      border-radius: 6px;
      padding: 0.3em 1em;
      cursor: pointer;
      text-shadow: 0 0 8px #00ffff;
    }
    button {
      background: linear-gradient(90deg, #6366f1 0%, #818cf8 100%);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.7rem 2.2rem;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px rgba(99,102,241,0.08);
    }
    button:hover {
      background: linear-gradient(90deg, #4f46e5 0%, #6366f1 100%);
    }
    #timer, #status {
      font-size: 1rem;
      color: #39FF14;
      margin-top: 0.2rem;
      min-height: 1.2em;
      text-align: center;
      text-shadow: 0 0 8px #39FF14;
    }
    #lyrics {
      margin-top: 1.2rem;
      background: #000;
      border-radius: 10px;
      padding: 1rem;
      width: 100%;
      box-sizing: border-box;
      color: #00ffff;
      font-size: 1.05rem;
      min-height: 3em;
      text-shadow: 0 0 8px #00ffff;
    }
    #lyrics h3 {
      margin: 0.5em 0 0.2em 0;
      color: #39FF14;
      font-size: 1.1em;
      text-shadow: 0 0 8px #39FF14;
    }
    audio {
      margin-top: 1.2rem;
      width: 100%;
      border-radius: 8px;
      background: #000;
      outline: none;
      box-shadow: 0 0 8px #00ffff;
    }
    @media (max-width: 500px) {
      .container {
        padding: 1.2rem 0.5rem 1.5rem 0.5rem;
        max-width: 98vw;
      }
      h1 {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>CleanSong Audio Processor</h1>
    <div class="file-input">
      <input type="file" id="file" accept="audio/*">
      <button id="process">Process</button>
    </div>
    <div id="timer"></div>
    <div id="status"></div>
    <div id="lyrics"></div>
    <audio id="outAudio" controls></audio>
  </div>

<script>
const btn = document.getElementById("process");
const fileInput = document.getElementById("file");
const lyricsDiv = document.getElementById("lyrics");
const outAudio = document.getElementById("outAudio");
const timerDiv = document.getElementById("timer");
const statusDiv = document.getElementById("status");

btn.onclick = async () => {
  const file = fileInput.files[0];
  if (!file) return alert("Choose a file!");
  if (file.size > 4 * 1024 * 1024) {
    alert("File is too large! Please select a file smaller than 4MB.");
    return;
  }

  let timer = 0;
  timerDiv.textContent = "Processing time: 0s";
  statusDiv.textContent = "";
  let interval = setInterval(() => {
    timer++;
    timerDiv.textContent = `Processing time: ${timer}s`;
  }, 1000);

  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64 = reader.result;
    try {
      statusDiv.textContent = "Calling Hugging Face API...";
      const res = await fetch("/api/process", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ file: base64 })
      });
      const json = await res.json();
      clearInterval(interval);
      timerDiv.textContent = `Total processing time: ${timer}s`;
      statusDiv.textContent = "Processing complete.";
      console.log(json);
      if (!res.ok) {
        lyricsDiv.innerHTML = `<span style=\"color:#39FF14\">Error: ${json.error || "Unknown error"}</span>`;
        return;
      }
      lyricsDiv.innerHTML = `
        <h3>Original Lyrics</h3><p>${json.original}</p>
        <h3>Cleaned Lyrics</h3><p>${json.cleaned}</p>
      `;
      if (json.audio?.url) {
        outAudio.src = json.audio.url;
        outAudio.load();
      }
    } catch (err) {
      clearInterval(interval);
      timerDiv.textContent = "";
      statusDiv.textContent = "";
      lyricsDiv.innerHTML = `<span style=\"color:#39FF14\">JS Error: ${err.message}</span>`;
      console.error(err);
    }
  };
  reader.readAsDataURL(file);
};
</script>
</body>
</html>
