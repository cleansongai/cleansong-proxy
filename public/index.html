<input type="file" id="file" accept="audio/*">
<button id="process">PROCESS - MUST BE LESS THAN 4 MB SIZE</button>
<div id="lyrics"></div>
<audio id="outAudio" controls></audio>

<script>
const btn = document.getElementById("process");
const fileInput = document.getElementById("file");
const lyricsDiv = document.getElementById("lyrics");
const outAudio = document.getElementById("outAudio");

btn.onclick = async () => {
  const file = fileInput.files[0];
  if (!file) return alert("Choose a file!");

  const reader = new FileReader();
  reader.onloadend = async () => {
    const base64 = reader.result;

    const res = await fetch("/api/process", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ file: base64 })
    });

    const json = await res.json();
    console.log(json);

    lyricsDiv.innerHTML = `
      <h3>Original Lyrics</h3><p>${json.original}</p>
      <h3>Cleaned Lyrics</h3><p>${json.cleaned}</p>
    `;

    if (json.audio?.url) {
      outAudio.src = json.audio.url;
      outAudio.load();
    }
  };
  reader.readAsDataURL(file);
};
</script>
